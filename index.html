<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AWorld ‚Äì 2D Math Adventure</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
}

#ui {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.8);
    padding: 12px;
    border-radius: 10px;
    width: 250px;
}

input, select, button {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
}

button {
    background: #4caf50;
    border: none;
    color: white;
    cursor: pointer;
}

.hidden {
    display: none;
}

canvas {
    display: block;
    background: #2c7a3f;
}

#popup {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.9);
    padding: 20px;
    border-radius: 12px;
    width: 300px;
    text-align: center;
}
</style>
</head>

<body>

<div id="ui">
    <div id="login">
        <h2>AWorld</h2>
        <input id="username" placeholder="Username">
        <select id="grade">
            <option value="">Grade</option>
            <option>3</option><option>4</option><option>5</option>
            <option>6</option><option>7</option><option>8</option>
        </select>
        <button onclick="start()">Start</button>
    </div>

    <div id="hud" class="hidden">
        <div id="stats"></div>
        <button onclick="openDaily()">Daily Quests</button>
    </div>
</div>

<canvas id="game"></canvas>
<div id="popup" class="hidden"></div>

<script>
/* ================= SAVE ================= */
let save = JSON.parse(localStorage.getItem("aworld2d")) || {
    name: "", grade: 3, xp: 0, level: 1, lastDay: ""
};
function saveGame() {
    localStorage.setItem("aworld2d", JSON.stringify(save));
}

/* ================= LOGIN ================= */
function start() {
    if (!username.value || !grade.value) return alert("Fill everything");
    save.name = username.value;
    save.grade = parseInt(grade.value);
    saveGame();
    login.classList.add("hidden");
    hud.classList.remove("hidden");
    updateHUD();
    initGame();
}

function updateHUD() {
    stats.innerHTML =
        `üë§ ${save.name}<br>
         üéì Grade ${save.grade}<br>
         ‚≠ê Level ${save.level}<br>
         ‚ö° XP ${save.xp}`;
}

/* ================= DAILY QUEST ================= */
function openDaily() {
    const today = new Date().toDateString();
    if (save.lastDay === today) return alert("Daily quests done!");

    let correct = 0;
    for (let i = 0; i < 4; i++) {
        let a = rand(save.grade * 5);
        let b = rand(save.grade * 5);
        if (!prompt(`${a} + ${b} = ?`)) return;
        if (parseInt(prompt(`${a} + ${b} = ?`)) === a + b) correct++;
    }

    if (correct === 4) {
        save.xp += 100;
        save.lastDay = today;
        if (save.xp >= save.level * 200) {
            save.xp = 0;
            save.level++;
        }
        saveGame();
        updateHUD();
        alert("Daily quests complete!");
    } else alert("Try again tomorrow!");
}

/* ================= GAME ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let player = { x: 100, y: 100, size: 20 };
let keys = {};

const zones = [
    { x: 300, y: 200, type: "add" },
    { x: 500, y: 200, type: "multiply" },
    { x: 700, y: 200, type: "speed" }
];

function initGame() {
    window.addEventListener("keydown", e => keys[e.key]=true);
    window.addEventListener("keyup", e => keys[e.key]=false);
    loop();
}

function loop() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Move
    if (keys["w"]) player.y -= 3;
    if (keys["s"]) player.y += 3;
    if (keys["a"]) player.x -= 3;
    if (keys["d"]) player.x += 3;

    // Player
    ctx.fillStyle = "cyan";
    ctx.fillRect(player.x, player.y, player.size, player.size);

    // Zones
    zones.forEach(z => {
        ctx.fillStyle = z.type === "add" ? "red" :
                        z.type === "multiply" ? "orange" : "purple";
        ctx.fillRect(z.x, z.y, 40, 40);

        if (Math.hypot(player.x - z.x, player.y - z.y) < 30) {
            openMinigame(z.type);
        }
    });

    requestAnimationFrame(loop);
}

/* ================= MINIGAMES ================= */
let inGame = false;

function openMinigame(type) {
    if (inGame) return;
    inGame = true;

    let a = rand(save.grade * 5);
    let b = rand(save.grade * 5);
    let question, answer;

    if (type === "add") { question = `${a} + ${b}`; answer = a + b; }
    if (type === "multiply") { question = `${a} √ó ${b}`; answer = a * b; }
    if (type === "speed") { question = `${a} - ${b}`; answer = a - b; }

    popup.innerHTML = `
        <h3>${type.toUpperCase()} GAME</h3>
        ${question} = ?
        <input id="ans">
        <button onclick="
            if(parseInt(ans.value)===${answer}) {
                save.xp+=20; saveGame(); updateHUD();
                popup.classList.add('hidden');
                inGame=false;
            } else alert('Wrong!');
        ">Submit</button>
    `;
    popup.classList.remove("hidden");
}

/* ================= UTILS ================= */
function rand(n) {
    return Math.floor(Math.random() * n) + 1;
}
</script>

</body>
</html>
